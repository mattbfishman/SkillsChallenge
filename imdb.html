<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>title</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  </head>
  <body>
  <form>
	  <div class="form-group">
	    <label for="movieLabel">Search Movie</label>
	    <input type="text" class="form-control" id="movieSearch" placeholder="Search Movie">
	  </div>

	  <button type="submit" id="search" class="btn btn-primary">Submit</button>
  </form>
  	<p id="imdbRotten">
  	</p>
  	<p id="nyTimes">
  	</p>



  	<p id ="theMovieDB">
  	</p>

  	<p id="nytimes-reviews">
  	</p>
  

  </body>
  <script>
  
    $( "#search" ).click(function() {

    	var movieData = 
    		{ movieName: $("#movieSearch").val(),
			  title: "",
			  actors: "",
			  director: "",
			  plotSummary: "",
			  awards: "",
			  genre: "",
			  IMDBNumberOfVotes: 0,
			  IMDBRating: 0,
			  tomatoNumberOfCriticReviews: 0,
			  tomatoCriticRating: 0,
			  tomatoCriticMeter: 0,
			  tomatoNumberOfUserReviews: 0,
			  tomatoUserRating: 0,
			  tomatoUserMeter: 0,
			  nytimesCriticApprovals: 0,
			  nytimeNumberOfCritics: 0,
			  moviedbPopulatrityRating: 0,
			  moviedbVoteAverage: 0,
			  moviedbVoteCount: 0
			}

	    var movieName = $("#movieSearch").val();
		NYTSearch(movieName);
		movieDBSearch(movieData);
		imdbRottenSearch(movieData);

	  	return false;


    });

	function movieDBSearch(movieData){
		$.getJSON('http://api.themoviedb.org/3/search/movie?api_key=def5f8b6f1de9e4a8a1b2f19b93c9680&query=' + movieData.movieName, function(data){
				movieData.moviedbPopulatrityRating = data.results[0].popularity;
				movieData.moviedbVoteAverage = data.results[0].vote_average;
				movieData.moviedbVoteCount = data.results[0].vote_count;
				console.log(movieData.moviedbVoteCount);
		});

	}

	function imdbRottenSearch(movieName){
		var imdbTomatoSearch = 'http://www.omdbapi.com/?t=' + movieName + '&y=&plot=short&tomatoes=true&r=json';
		$.getJSON( imdbTomatoSearch, function(data) {
			
			movieData.title = data.Title;
			movieData.actors = data.Actors;
			movieData.director = data.Director;
			movieData.plotSummary = data.Plot;
			movieData.awards = data.Awards;
			movieData.genre = data.Genre;
			movieData.IMDBNumberOfVotes = data.imdbVotes;
			movieData.IMDBRating = data.imdbRating;
			movieData.tomatoNumberOfCriticReviews = data.tomatoReviews;
			movieData.tomatoCriticRating = data.tomatoRating;
			movieData.tomatoCriticMeter = data.tomatoCriticMeter;
			movieData.tomatoNumberOfUserReviews = data.tomatoUserReviews;
			movieData.tomatoUserRating = data.tomatoUserRating;
			movieData.tomatoUserMeter = data.tomatoUserMeter;
	
		});
	}

	var NewYorkTimesReviews = []

	var NYTSearch = function(movieData){

	var nytUrl = "https://api.nytimes.com/svc/movies/v2/reviews/search.json";
	
	nytUrl += '?' + $.param({
	  'api-key': "64483963a3d84321b85ce91504cd34f2",
	  'query' : movieData.movieName;
	});

	$.ajax({
	  url: nytUrl,
	  method: 'GET',
	}).done(function(result) {
	  console.log(result);
	  if(result.results.num_results)
	  	NewYorkTimesReviews = result.results;
	    let picks = 0;
	    let reviews = document.getElementById("nytimes-reviews");
	    for(i=0; i<result.results.length; i++){
	    	picks += result.results[i].critics_pick;
	    	let review = result.results[i];
	    	let thumb = "";
	    	
	    	if(review.critics_pick)
	    		thumb = "&#128077; "
	    	else
	    		thumb = "&#128078; "
	    }
	  	movieData.nytimesCriticApprovals = picks;
	  	movieData.nytimesNumberOfCritics = result.results.length;

	}).fail(function(err) {
	  throw err;
	});

	}
  </script>
</html>